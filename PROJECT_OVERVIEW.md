# 人体动作预测项目概览

## 🎯 项目简介

本项目实现了一个创新的人体动作预测系统，结合了**物理约束样条学习(PISL)**和**HumanMAC扩散模型**，实现了高精度、物理合理的人体运动预测。

### 核心创新点

1. **PISL + HumanMAC融合**: 首次将物理约束的B样条学习与扩散模型结合
2. **自适应权重融合**: 智能调节两种预测方法的贡献度
3. **物理约束保证**: 确保预测结果符合人体运动学规律
4. **端到端训练**: 统一的训练框架，优化融合效果

## 🏗️ 系统架构

```
┌─────────────────────────────────────────────────────────────────┐
│                        输入历史运动序列                          │
└─────────────────────┬───────────────────────────────────────────┘
                      │
           ┌──────────┴──────────┐
           │                     │
           ▼                     ▼
┌─────────────────┐    ┌─────────────────┐
│   PISL模块      │    │  HumanMAC模块    │
│                 │    │                 │
│ • B样条学习     │    │ • Transformer   │
│ • 物理约束      │    │ • 扩散生成      │
│ • 运动学方程    │    │ • 条件生成      │
└─────────┬───────┘    └─────────┬───────┘
          │                      │
          └──────────┬───────────┘
                     ▼
          ┌─────────────────┐
          │   融合模块      │
          │                 │
          │ • 自适应权重    │
          │ • 特征融合      │
          │ • 物理验证      │
          └─────────┬───────┘
                    ▼
          ┌─────────────────┐
          │   预测结果      │
          └─────────────────┘
```

## 📊 技术栈

### 核心框架
- **PyTorch**: 深度学习框架
- **NumPy/SciPy**: 科学计算
- **scikit-learn**: 机器学习工具

### 可视化工具
- **Matplotlib**: 基础绘图
- **Plotly**: 交互式3D可视化
- **Seaborn**: 统计图表

### 实验管理
- **TensorBoard**: 训练监控
- **Weights & Biases**: 实验跟踪
- **YAML**: 配置管理

## 🧠 核心模块详解

### 1. PISL样条学习模块 (`pisl_spline.py`)

**功能**:
- 使用B样条拟合关节轨迹
- 施加物理约束（速度、加速度限制）
- 学习运动学方程参数

**关键特性**:
- Cox-de Boor算法实现B样条基函数
- 多层次物理约束（关节限制、速度约束、加速度约束）
- 平滑性优化（基于jerk的损失函数）

### 2. HumanMAC扩散模型 (`humanmac_diffusion.py`)

**功能**:
- 基于Transformer的编码器-解码器架构
- 条件扩散生成，以历史运动为条件
- 支持DDPM和DDIM采样

**关键特性**:
- 正弦位置编码处理时间信息
- 多头自注意力和交叉注意力机制
- 运动学参数嵌入，集成PISL信息

### 3. 融合预测模块 (`fusion_model.py`)

**功能**:
- 自适应融合PISL和扩散模型预测
- 多层次特征融合
- 物理合理性验证

**关键特性**:
- 学习型权重预测器
- 连续性约束保证
- 多模式预测支持

## 📈 评估体系

### 精度指标
- **MPJPE**: 平均关节位置误差
- **P-MPJPE**: Procrustes对齐后的MPJPE
- **速度误差**: 关节速度预测准确性
- **加速度误差**: 关节加速度预测准确性

### 物理合理性
- **物理违规率**: 违反物理约束的比例
- **骨长一致性**: 骨骼长度保持度
- **运动平滑性**: 基于jerk的平滑度评估

### 多样性指标
- **FID分数**: 生成质量评估
- **多样性分数**: 预测多样性评估

## 🎨 可视化功能

### 3D动画
- 人体骨架3D动画生成
- 多预测方法对比动画
- 交互式3D可视化

### 分析图表
- 轨迹对比图
- 误差热力图
- 指标对比柱状图
- 物理约束违规分析

## 🔧 使用场景

### 研究应用
- 人体运动分析
- 运动生物力学研究
- 机器人运动规划

### 工业应用
- 动画制作
- 虚拟现实
- 体感游戏
- 运动康复

## 📁 项目文件结构

```
human_motion_prediction/
├── models/                     # 核心模型
│   ├── pisl_spline.py         # PISL样条学习
│   ├── humanmac_diffusion.py  # HumanMAC扩散模型
│   └── fusion_model.py        # 融合预测模型
├── data/                      # 数据处理
│   └── preprocessing.py       # 数据预处理
├── training/                  # 训练模块
│   └── train_fusion.py        # 训练脚本
├── evaluation/                # 评估模块
│   ├── metrics.py             # 评估指标
│   └── visualize.py           # 可视化工具
├── configs/                   # 配置管理
│   └── config.yaml            # 主配置文件
└── inference.py               # 推理脚本

examples/                      # 示例代码
├── demo.py                    # 完整演示
└── simple_demo.py             # 简化演示

docs/                          # 文档
├── README.md                  # 详细文档
├── QUICKSTART.md              # 快速入门
└── PROJECT_OVERVIEW.md        # 项目概览

setup.py                       # 项目安装
requirements.txt               # 依赖列表
install.sh                     # 安装脚本
```

## 🚀 快速开始

### 1. 环境安装
```bash
# 一键安装
./install.sh --venv

# 或手动安装
pip install -r requirements.txt
```

### 2. 运行演示
```bash
# 简化演示（无依赖）
python3 examples/simple_demo.py

# 完整演示
python examples/demo.py
```

### 3. 训练模型
```bash
python human_motion_prediction/training/train_fusion.py
```

### 4. 模型推理
```bash
python human_motion_prediction/inference.py --model checkpoints/best_model.pth
```

## 📊 性能基准

### 数据集支持
- **Human3.6M**: 主要基准数据集
- **HumanEva-I**: 补充验证数据集
- **AMASS**: 零样本测试数据集

### 预期性能指标
- **MPJPE**: < 40mm (25帧预测)
- **物理违规率**: < 5%
- **推理速度**: > 30 FPS
- **训练时间**: ~12小时 (单GPU)

## 🔬 技术细节

### PISL算法特点
- **B样条阶数**: 3阶（三次样条）
- **控制点数量**: 自适应选择
- **物理约束**: 多层次约束体系
- **优化算法**: Adam + L-BFGS混合优化

### 扩散模型配置
- **扩散步数**: 1000步训练，50步推理
- **噪声调度**: 余弦调度
- **网络架构**: Transformer (8层，512维)
- **注意力头数**: 8个多头注意力

### 融合策略
- **权重学习**: MLP权重预测器
- **特征融合**: 多层感知机融合层
- **损失权重**: 自适应损失平衡

## 🎯 未来发展

### 短期目标
- [ ] 支持更多数据集格式
- [ ] 优化推理速度
- [ ] 增加更多可视化功能
- [ ] 完善文档和教程

### 长期规划
- [ ] 支持实时预测
- [ ] 多人交互预测
- [ ] 场景感知预测
- [ ] 移动端部署

## 🤝 贡献指南

### 开发环境
```bash
git clone <repository>
cd human_motion_prediction
./install.sh --venv
```

### 代码规范
- 遵循PEP 8编码规范
- 添加详细的docstring
- 编写单元测试
- 更新相关文档

### 提交流程
1. Fork项目
2. 创建特性分支
3. 编写代码和测试
4. 提交Pull Request

## 📞 支持与联系

### 获取帮助
- 查看文档: `README.md`, `QUICKSTART.md`
- 运行演示: `python3 examples/simple_demo.py`
- 检查配置: `human_motion_prediction/configs/config.yaml`

### 问题反馈
- 创建GitHub Issue
- 发送邮件咨询
- 参与讨论区交流

## 📄 许可证

本项目采用MIT许可证，允许自由使用、修改和分发。

---

**🎉 感谢使用人体动作预测项目！让我们一起推动人体运动分析技术的发展！**